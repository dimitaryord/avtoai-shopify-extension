"use strict";function t(t,e){const s="light"==e?"#fefefe":"#222831",n="light"==e?"#000000aa":"#ffffffab",a="light"==e?"black":"white",i=function(t){t=t.substring(1);let e=parseInt(t,16);return.2126*(e>>16&255)+.7152*(e>>8&255)+.0722*(e>>0&255)>150}(t)?"black":"white",o="light"==e?"white":"black";document.documentElement.style.setProperty("--avtoai-assistant-colors-color-theme",t),document.documentElement.style.setProperty("--avtoai-assistant-colors-app-theme",s),document.documentElement.style.setProperty("--avtoai-assistant-colors-widget-button-shadow",n),document.documentElement.style.setProperty("--avtoai-assistant-colors-text-color",a),document.documentElement.style.setProperty("--avtoai-assistant-colors-color-theme-text-color",i),document.documentElement.style.setProperty("--avtoai-assistant-colors-text-shadow",o)}const e={designComponent:(t,{classes:e,style:s,id:n,text:a,hover:i})=>(e&&t.classList.add(...e),s&&Object.assign(t.style,s),n&&(t.id=n),a&&(t.textContent=a),i&&(t.onmouseover=()=>Object.assign(t.style,i),t.onmouseout=()=>Object.assign(t.style,s)),t),div:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("div");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},a:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("a");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},h1:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("h1");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},h2:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("h2");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},h3:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("h3");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},h4:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("h4");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},h5:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("h5");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},h6:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("h6");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},p:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("p");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},button:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("button");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})},input:({classes:t,style:s,id:n,text:a,hover:i})=>{const o=document.createElement("input");return e.designComponent(o,{classes:t,style:s,id:n,text:a,hover:i})}};Object.freeze(e);class s{constructor(t,e){t&&t.appendChild(e)}playElementAnimation(t,e,s){t.style.animation="",t.offsetWidth,t.style.animation=e+" "+s}}var n={TextP:class extends s{constructor(t,e,s){const n=document.createElement("p");n.classList.add(s?"avtoai-assistant-p-text-shadow":"avtoai-assistant-p-text"),n.textContent=e,super(t,n)}},ThemeButton:class extends s{constructor(t,s){const n=e.button({id:"avtoai-assistant-theme-button",style:{cursor:"pointer",width:"fit-content",fontSize:"1.5rem",marginBottom:"1.25rem",paddingBlock:"2rem",paddingInline:"2.25rem",borderRadius:"10px",border:"none",color:"var(--avtoai-assistant-colors-color-theme-text-color)",backgroundColor:"var(--avtoai-assistant-colors-color-theme)"},text:s});return super(t,n),n}},ThemeCloseButton:class extends s{constructor(t){const e=document.createElement("div");e.classList.add("avtoai-assistant-theme-close-button-container"),e.id="avtoai-assistant-theme-close-button-container";for(let t=0;t<2;t++){const t=document.createElement("div");t.classList.add("avtoai-assistant-theme-close-button-cross"),t.style.display="block",e.appendChild(t)}super(t,e),this.closeButton=e}},ConditionalRendering:class{constructor(t){if(!t)return null;const e=document.createElement("div");return e.id="avtoai-conditional-rendering-element",e}}};class a extends s{constructor({container:t,position:e}){const s=document.createElement("div");s.id="avtoai-assistant-side-drawer-container";const n=document.createElement("div");n.classList.add("avtoai-assistant-side-drawer-blur"),n.id="avtoai-assistant-side-drawer-blur","right"==e?n.style.right="0px":"left"==e&&(n.style.left="0px"),n.style.display="block";const a=document.createElement("div");a.classList.add("avtoai-assistant-side-drawer"),a.id="avtoai-assistant-side-drawer","right"==e?(a.style.right="10px",a.style.transform="translate(110%, -50%)"):"left"==e&&(a.style.left="10px",a.style.transform="translate(-110%, -50%)"),s.appendChild(n),s.appendChild(a),super(t,s),this.side=e,this.isOpen=!1,this.sideDrawerBlur=n,this.content=a,document.addEventListener("click",(t=>{t.target==n&&this.close()}))}close(){this.isOpen=!1,this.playAnimation("reverse")}open(){this.isOpen=!0,this.playAnimation()}playAnimation(t="normal"){this.playElementAnimation(this.sideDrawerBlur,"avtoai-assistant-slide-blur 0.2s forwards",t),this.playElementAnimation(this.content,`avtoai-assistant-slide-drawer-${this.side} 0.4s ease-out forwards`,t)}}var i=(t,e,s)=>`<svg loading="lazy" viewBox="0 0 16 16" width="${s}" height="${e}" xmlns="http://www.w3.org/2000/svg" fill="none" class="hds-flight-icon--animation-loading"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g fill="${t}" fill-rule="evenodd" clip-rule="evenodd"> <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z" opacity=".2"></path> <path d="M7.25.75A.75.75 0 018 0a8 8 0 018 8 .75.75 0 01-1.5 0A6.5 6.5 0 008 1.5a.75.75 0 01-.75-.75z"></path> </g> </g></svg>`;class o extends s{constructor({container:t,assistantName:s,assistantImage:a,startInLoading:i}){const o=e.div({id:"avtoai-assistant-chat-header",classes:["avtoai-assistant-chat-header"]}),r=e.div({id:"avtoai-assistant-chat-header-top-container",style:{display:"flex"}}),c=e.div({id:"avtoai-assistant-chat-header-bottom-container",style:{display:"flex",flexGrow:"1",alignItems:"center",justifyContent:"center"}}),l=e.div({id:"avtoai-assistant-chat-close-button-container",style:{display:"flex",flexGrow:"1",alignItems:"center",justifyContent:"end"}});o.appendChild(r),o.appendChild(c),super(t,o);const d=this.createMenu(),h=new n.ThemeCloseButton(l),{titleContainer:p,titleText:m}=this.createTitle(s,a);r.appendChild(d),r.appendChild(l),i||c.appendChild(p),this.bottomContainer=c,this.titleContainer=p,this.title=m,this.closeButton=h.closeButton}createMenu(){const t=document.createElement("div");t.classList.add("avtoai-assistant-chat-menu-container"),t.id="avtoai-assistant-chat-menu-container";for(let e=0;e<3;e++){const e=document.createElement("div");e.style.display="block",e.classList.add("avtoai-assistant-chat-menu-dot"),t.appendChild(e)}return t}createTitle(t,s){const n=e.div({id:"avtoai-assistant-chat-title-container",classes:["avtoai-assistant-chat-title-container"]}),a=document.createElement("img");a.loading="lazy",a.src=s,a.alt="avtoai-assistant-chat-bot-icon";const i=e.designComponent(a,{style:{width:"50px",height:"50px",borderRadius:"10px",filter:"drop-shadow( var(--avtoai-assistant-colors-widget-box-shadow) 0.1rem 0.1rem )"}}),o=e.h3({classes:["avtoai-assistant-chat-title-text"],text:t});return n.appendChild(i),n.appendChild(o),{titleContainer:n,titleText:o}}setTitle(t){this.title.textContent=t}switchToReady(){this.bottomContainer.appendChild(this.titleContainer)}switchToLoading(){this.bottomContainer.removeChild(this.titleContainer)}}class r extends s{constructor(t){const s=e.div({id:"avtoai-assistant-chat-section-container",style:{display:"flex",overflowY:"auto",flexDirection:"column",flexGrow:"1",alignItems:"flex-start",padding:"1.25rem"}});return super(t,s),s}}class c extends s{constructor(t){const s=e.div({id:"avtoai-assistant-actions-container",classes:["avtoai-assistant-action-section-container"],style:{display:"flex"}}),n=e.div({id:"avtoai-assistant-actions-starters-button-container",classes:["avtoai-assistant-actions-starters-button-container"]});var a;n.innerHTML=`<svg loading="lazy" width="25px" height="25px" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--emojione-monotone" preserveAspectRatio="xMidYMid meet">\n<g fill-rule="evenodd">\n<path d="M30.249 2.065C18.612 2.789 12.531 9.379 12 21.296h11.739c.147-4.128 2.451-7.214 6.741-7.669c4.211-.447 8.206.556 9.416 3.435c1.307 3.11-1.627 6.724-3.022 8.241c-2.582 2.813-6.776 4.865-8.95 7.9c-2.131 2.974-2.51 6.887-2.674 11.676h10.346c.145-3.062.349-5.995 1.742-7.898c2.266-3.092 5.65-4.541 8.486-6.983c2.709-2.334 5.559-5.147 6.043-9.501C53.32 7.466 42.683 1.289 30.249 2.065" fill="${a="var(--avtoai-assistant-colors-color-theme-text-color)"}">\n</path>\n<ellipse cx="30.515" cy="55.567" rx="6.532" ry="6.433" fill="${a}">\n</ellipse>\n</g>\n</svg>`;const i=e.div({id:"avtoai-assistant-actions-input-container",classes:["avtoai-assistant-actions-input-container"]}),o=e.input({id:"avtoai-assistant-actions-input",classes:["avtoai-assistant-actions-input"]});o.placeholder="Chat here",i.appendChild(o);const r=e.div({classes:["avtoai-assistant-actions-send"]});r.innerHTML=(t=>`<svg loading="lazy" width="50px" height="50px" viewBox="0 0 24 24" fill="${t}" xmlns="http://www.w3.org/2000/svg">\n    <path d="M6.99811 10.2467L7.43298 11.0077C7.70983 11.4922 7.84825 11.7344 7.84825 12C7.84825 12.2656 7.70983 12.5078 7.43299 12.9923L7.43298 12.9923L6.99811 13.7533C5.75981 15.9203 5.14066 17.0039 5.62348 17.5412C6.1063 18.0785 7.24961 17.5783 9.53623 16.5779L15.8119 13.8323C17.6074 13.0468 18.5051 12.654 18.5051 12C18.5051 11.346 17.6074 10.9532 15.8119 10.1677L9.53624 7.4221C7.24962 6.42171 6.1063 5.92151 5.62348 6.45883C5.14066 6.99615 5.75981 8.07966 6.99811 10.2467Z"/>\n</svg>`)("var(--avtoai-assistant-colors-color-theme-text-color)"),i.appendChild(r),s.appendChild(n),s.appendChild(i),super(t,s),this.input=o,this.sendButton=r,this.content=s}}class l{constructor({drawer:t,assistantName:e,assistantImage:s,startInLoading:n=!0}){const a=new o({container:t.content,assistantName:e,assistantImage:s,startInLoading:n});let i,l,d;a.closeButton.onclick=()=>t.close(),d=this.createLoadingComponent(),n?(i=new r(null),l=new c(null),t.content.appendChild(d)):(i=new r(t.content),l=new c(t.content)),this.container=t.content,this.loading=n,this.sections={headerSection:a,chatSection:i,actionSection:l},this.loadingComponent=d,l.sendButton.onclick=t=>this.onSend(t,l),document.addEventListener("keydown",(async t=>{"Enter"===t.key&&this.onSend(t,l)}))}switchToReady(){this.loading&&(this.sections.headerSection.switchToReady(),this.container.contains(this.loadingComponent)&&this.container.removeChild(this.loadingComponent),this.container.appendChild(this.sections.chatSection),this.container.appendChild(this.sections.actionSection.content),this.loading=!1)}switchToLoading(){this.loading||(this.sections.headerSection.switchToLoading(),this.container.contains(this.sections.chatSection)&&this.container.removeChild(this.sections.chatSection),this.container.contains(this.sections.actionSection.content)&&this.container.removeChild(this.sections.actionSection.content),this.container.appendChild(this.loadingComponent),this.loading=!0)}createLoadingComponent(){const t=e.div({id:"avtoai-assistant-chat-app-loading-container",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}}),s=e.div({id:"avtoai-assistant-chat-app-loading",style:{animation:"avtoai-assistant-spin 2s linear infinite",height:"60px"}});return s.innerHTML=i("var(--avtoai-assistant-colors-color-theme)","60px","60px"),t.appendChild(s),t}async onSend(t,s){t&&t.preventDefault();const n=s.input.value.trim();n.length>0&&this.onMessageSent&&(this.sections.actionSection.sendButton.disabled=!0,e.designComponent(this.sections.actionSection.sendButton,{style:{cursor:"default"}}),s.input.value="",await this.onMessageSent(n),this.sections.actionSection.sendButton.disabled=!1,e.designComponent(this.sections.actionSection.sendButton,{style:{cursor:"pointer"}}))}}const d=new class{constructor(){this.staticUrl="/apps/server",this.config={method:"GET",headers:{"Content-Type":"application/json","Shopify-Store-Domain":""},body:JSON.stringify({})}}setShop(t){this.config.headers["Shopify-Store-Domain"]=t}async get(t){try{this.config.method="GET";const e=await fetch(`${this.staticUrl}${t}`,this.config);if(e.ok){return await e.json()}return{error:await e.json()}}catch(t){console.log(t),console.error(t.message)}}async post(t,e={}){try{this.config.method="POST",this.config.body=JSON.stringify(e);const s=await fetch(`${this.staticUrl}${t}`,this.config);if(s.ok){return await s.json()}return{error:await s.json()}}catch(t){console.log(t),console.error(t.message)}}};function h(t,e){sessionStorage.setItem(t,JSON.stringify(e))}function p(t){const e=sessionStorage.getItem(t);return e?JSON.parse(e):null}async function m({productHandle:t,variantId:e}){try{const s=await fetch(`/products/${t}.js`),n=await s.json(),a=n.variants.find((t=>t.id===parseInt(e)));let i=a.featured_image;i||(n.featured_image?i=n.featured_image:n.images.length>0&&(i=n.images[0]));return{title:a.name,price:a.price/100,imageUrl:i?i.startsWith("https:")?i:`https:${i}`:null}}catch(t){throw new Error("Error fetching product details: "+t)}}class u{constructor(t,s,n){const a=e.div({id:"avtoai-assistant-message-container",style:{maxWidth:"80%",borderRadius:"10px",paddingInline:"1.25rem",marginBottom:"1.5rem",alignSelf:"assistant"===s?"flex-start":"flex-end",backgroundColor:"assistant"===s?"var(--avtoai-assistant-colors-message-assistant-bg)":"var(--avtoai-assistant-colors-color-theme)"}}),i=e.p({id:"avtoai-assistant-message",style:{color:"assistant"===s?"black":"var(--avtoai-assistant-colors-color-theme-text-color)"},text:t});return n&&i.appendChild(n),a.appendChild(i),[a,i]}}class g extends s{constructor(t,e,s){const[n,a]=new u(e,s);super(t,n),this.container=n,this.textElement=a}}class v extends s{constructor(t){const s=e.div({id:"avtoai-assistant-chat-app-message-loading",style:{animation:"avtoai-assistant-spin 2s linear infinite",height:"30px"}});s.innerHTML=i("var(--avtoai-assistant-colors-color-theme)","30px","30px");const[n]=new u("","assistant",s);super(t,n)}}class y extends s{constructor(t,{title:s,price:n,variantId:a,imageUrl:i}){const o=e.div({id:"avtoai-assistant-chat-app-message-product-card"}),r=e.h3({id:"avtoai-assistant-chat-app-message-product-card-title",style:{marginBlockEnd:"1rem"},text:s}),c=document.createElement("img");c.loading="lazy",c.src=i,c.alt="product-image",e.designComponent(c,{id:"avtoai-assistant-chat-app-message-product-card-image",style:{width:"300px",marginTop:"2.25rem"}});const l=e.p({id:"avtoai-assistant-chat-app-message-card-price",style:{marginBlockStart:"0px",marginBottom:"2.25rem"},text:new Intl.NumberFormat("bg-BG",{style:"currency",currency:"BGN"}).format(n)});o.appendChild(c),o.appendChild(r),o.appendChild(l),super(t,o);const d=this.createAddToCartButton();d.onclick=async()=>{await async function(t,e){const s={items:[{id:parseInt(t),quantity:e}]};try{const t=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(t.ok){const e=await t.json();console.log("Item added to cart",e)}else console.error("Failed to add item to cart. Status code:",t.status)}catch(t){console.error("Error adding item to cart:",t)}}(a,1),window.open(window.Shopify.routes.root+"cart")},o.appendChild(d)}createAddToCartButton(){return e.button({id:"avtoai-assistant-chat-app-messages-add-to-cart-button",style:{display:"block",cursor:"pointer",width:"300px",marginBottom:"1.25rem",paddingInline:"1.25rem",paddingBlock:"1rem",textAlign:"center",border:"1px solid black",color:"var(--avtoai-assistant-colors-message-assistant-bg)",backgroundColor:"black",transform:"scale(1)",transition:"transform 0.5s"},hover:{transform:"scale(1.05)"},text:"Add to Cart"})}}function f(t,e){for(let s of e)console.log(t,s),t.textContent=t.textContent.replace(s.text,"")}function x(t){const e=t.textContent,s=e.match(/product_handle:\s*([^\s]+)/i),n=e.match(/variant_id:\s*(gid:\/\/shopify\/ProductVariant\/\d+)/i);if(s&&n){const[a,i]=s,[o,r]=n;return t.textContent=e.split(a).join("").split(o).map((t=>t.trim())).join(""),{productHandle:i,variantId:r.split("/").pop()}}}async function C({container:t,messages:e,staticAddedMessages:s}){const n=function(t,e=null,s=0){if(e&&t.childElementCount===e.length-2+s){for(let e=0;e<s;e++)t.removeChild(t.lastChild);return!1}for(;t.firstChild;)t.removeChild(parent.firstChild);return!0}(t,e,s),[a]=new u("","user"),[i]=new u("","assistant"),o=n?e:e.slice(e.length-2,e.length);for(let e=0;e<o.length;e++){const s=o[e],n="assistant"===s.role?i.cloneNode(!0):a.cloneNode(!0);if(n.children[0].textContent=s.messageText,t.appendChild(n),f(n.children[0],s.annotations),console.log(s.annotations),"assistant"===s.role){const t=x(n.children[0]);if(t){const e=await m(t);new y(n,{...e,variantId:t.variantId})}}}}function w(){const e=document.getElementById("avtoai-assistant-bot-container"),s=document.getElementById("avtoai-assistant-widget-button"),n=e.getAttribute("data-shop-domain");d.setShop(n),console.log(d);t(e.getAttribute("data-avtoai-color-theme-app"),e.getAttribute("data-avotai-theme-app"));const i=e.getAttribute("data-avtoai-chat-position"),o=e.getAttribute("data-avtoai-chat-image");e.removeAttribute("data-shop-domain"),e.removeAttribute("data-avtoai-chat-image");const r=new a({container:e,position:i}),c=p("avtoai-assistant-name"),m=new l({drawer:r,assistantName:c||"Avto AI chatbot Here to help you",assistantImage:o});if(m.onMessageSent=async t=>{const e=p("avtoai-assistant-thread");if(!e)return;new g(m.sections.chatSection,t,"user"),new v(m.sections.chatSection);const s=await d.post("/chat",{userMessage:t,threadId:e});C({container:m.sections.chatSection,messages:s.messages.reverse(),staticAddedMessages:2})},!s)return console.error("No widget button element found");s.onclick=async()=>{if(r.isOpen)r.close();else{r.open(),m.switchToLoading();const t=p("avtoai-assistant-thread"),e=p("avtoai-assistant-name");if(t&&e){const e=await d.post("/pull/messages",{threadId:t});e.messages&&C({container:m.sections.chatSection,messages:e.messages.reverse()})}else{const t=await d.post("/create/thread");m.sections.headerSection.setTitle(t.assistantName),h("avtoai-assistant-thread",t.threadId),h("avtoai-assistant-name",t.assistantName)}m.switchToReady()}}}document.addEventListener("DOMContentLoaded",(()=>{w()}));
